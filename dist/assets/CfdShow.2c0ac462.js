var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,n)=>{for(var l in n||(n={}))a.call(n,l)&&i(e,l,n[l]);if(t)for(var l of t(n))r.call(n,l)&&i(e,l,n[l]);return e};import{G as l,E as o,a as s,n as d}from"./template.39cb3016.js";import{y as c,z as h,b as g,A as f,E as p,G as u,r as m,o as b,c as y,f as v,H as k,g as x}from"./vendor.e6acaae6.js";import{k as w}from"./index.8a97e1bb.js";var F={setup(e,t){const a=c(w),r=h({ant:null,data:a.getters.graph}),i=g(!1),m=g(!1);let b=null;const y=g(!1),v=g(null),k=g(null),{proxy:x}=u(),F=x.$api,I=()=>{clearInterval(b)},S=e=>{const t=document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.borderRadius="100%",t.innerText=e,t};f((()=>{I()})),p((()=>{(()=>{if(y.value)return;r.ant=new l({container:v.value,width:parseInt(r.data.width),height:parseInt(r.data.height),grid:{visible:!1,size:2},resizing:{enabled:()=>m.value},snapline:{enabled:!0,sharp:!0,tolerance:2},interacting:{nodeMovable:()=>m.value},selecting:{enabled:()=>m.value,rubberband:!0,showNodeSelectionBox:!0},connecting:{router:"manhattan",createEdge:()=>new o({shape:"custom-edge"})}}),l.unregisterEdge("custom-edge"),l.registerEdge("custom-edge",{inherit:"edge",attrs:{line:{stroke:"#5755a1"}},defaultLabel:{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{label:{fill:"black",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},body:{ref:"label",fill:"white",stroke:"#5755a1",strokeWidth:2,rx:4,ry:4,refWidth:"140%",refHeight:"140%",refX:"-20%",refY:"-20%"}},position:{distance:100,options:{absoluteDistance:!0,reverseDistance:!0}}}},!0),l.registerNode("custom-image",{inherit:"rect",width:52,height:52,zIndex:100,markup:[{tagName:"image"}],attrs:{image:{width:52,height:52}},ports:n({},{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]})},!0),l.registerNode("custom-text",{inherit:"rect",width:26,height:26,zIndex:100,markup:[{tagName:"text",selector:"label"}],attrs:{label:{textAnchor:"left",textVerticalAnchor:"top",fontSize:18,fill:"yellow"}}},!0),r.ant.drawBackground({image:"/background.jpg",position:"center",size:"100% auto"}),y.value=!0,console.log(r.ant)})(),F.graph.graph.readJson({id:r.data.graphId}).then((e=>{console.log(e),r.ant.fromJSON(e),r.ant.getNodes().map((e=>{if("html"===e.shape){const t=r.ant.findView(e).findOne("foreignObject > body > div");0===t.childElementCount&&t.append(S("")),e.setAttrByPath(s.fontSize,"10"),e.getPosition(),e.setSize({width:10,height:10}),"警告"===e.data.message?e.setAttrByPath(s.color,"#ff0000"):e.setAttrByPath(s.color,"#00ff00")}}))}))}));const E=g(1);return{graph:r,initFinsh:y,refContainer:v,refScreen:k,fullScreen:()=>{let e=document.getElementById("refScreen"),t=document.getElementById("myGraph");e.requestFullscreen().then((a=>{const i=r.data.width,n=r.data.height,l=e.clientWidth,o=e.clientHeight,s=l/i,d=o/n,c=(l-i)/2,h=(o-n)/2;t.style.width=i+"px",t.style.height=n+"px",t.style.transform="translate("+c+"px,"+h+"px)  scale("+s+","+d+") ",console.log("正常打开全屏")}),(e=>{console.log("不正常打开全屏")}))},run:()=>{i.value||(b=setInterval((()=>{F.graph.node.lists(r.data).then((e=>{e.map((e=>{let t=r.ant.getCellById(e.nodeId);if(t&&("模拟量"===t.data.message?t.setAttrByPath(s.lable,e.data):t.setAttrByPath(s.lable,""),e.active)){let a=t.data.type;if(a){let i=d[a];if(i){i.filter((e=>"algorithm"===e.type)).map((a=>{a.algorithm.run(t,r.ant,e.active,e.data)}))}}}}))}))}),2e3))},index:E,stop:I}}};const I=x("全屏"),S=x("运行"),E=x("停止"),z={id:"refScreen"},A={className:"graph",id:"myGraph",ref:"refContainer"};F.render=function(e,t,a,r,i,n){const l=m("a-button");return b(),y("div",null,[v(l,{onClick:r.fullScreen},{default:k((()=>[I])),_:1},8,["onClick"]),v(l,{onClick:r.run},{default:k((()=>[S])),_:1},8,["onClick"]),v(l,{onClick:r.stop},{default:k((()=>[E])),_:1},8,["onClick"]),v("div",z,[v("div",A,null,512)])])};export default F;
