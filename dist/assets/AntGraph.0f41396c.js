var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,i=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&r(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&r(e,l,t[l]);return e};import{A as s,C as u,H as d,M as c,S as h,b as g,c as v,T as p,K as m,D as f,d as b,G as y,N as w,n as C,e as k,r as x,E as F,a as I}from"./template.39cb3016.js";import{u as S}from"./ResizeObserver.es.deae8aad.js";import{b as _,E as N,aJ as $,aK as A,p as D,e as E,o as O,c as B,f as j,aL as V,aM as M,w as U,r as P,aN as L,aO as z,z as H,H as W,g as G,aP as T,G as J,y as R,A as X}from"./vendor.e6acaae6.js";import{k as K}from"./index.8a97e1bb.js";var Y=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",get AutoSave(){return s},Clipboard:u,get Halo(){return d},MiniMap:c,get Scroller(){return h},Selection:g,Snapline:v,Transform:p,Knob:m,get Dnd(){return f},get Stencil(){return b}});const q={name:"Pinker",props:{color:{type:String||Object},preset:{type:Array,default:()=>["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"]}},setup(e,a){const n={saturation_value:_(null),hue_slider:_(null),alpha_slider:_(null)};let o=_("top: 25%;left: 80%;"),r=_("left: 0;"),s=_("left: calc(100% - 6px);"),u=_(0),d=_(1),c=_(1),h=_(255),g=_(0),v=_(0),p=_(1);N((()=>{let{r:t,g:l,b:a,a:n}=function(e){if(!e)return null;{let t,l,a,n;if("string"!=typeof e)return t=e.r>255?255:e.r<0?0:e.r,l=e.g>255?255:e.g<0?0:e.g,a=e.b>255?255:e.b<0?0:e.b,n=e.a>1?1:e.a<0?0:e.a,{r:t,g:l,b:a,a:n};if(/^#?([0-9a-fA-F]{6}|[0-9a-fA-F]{8}|[0-9a-fA-F]{3}|[0-9a-fA-F]{4})$/.test(e))return I(e)}}(e.color);h.value=t,g.value=l,v.value=a,p.value=n})),$([h,g,v],(e=>{console.log(m),console.log(m.value.hex8),a.emit("update:color",m.value.hex8);let{h:t,s:l,v:n}=function(e,t,l){let a,n,o,r=e/255,i=t/255,s=l/255,u=Math.max(r,i,s),d=Math.min(r,i,s),c=u-d;0===c?a=0:u===r?a=(60*(i-s)/c+360)%360:u===i?a=60*((s-r)/c+2):u===s&&(a=60*((r-i)/c+4));n=0===u?0:c/u;return o=u,a=Math.floor(a+.5),n=Math.floor(100*n+.5)/100,o=Math.floor(100*o+.5)/100,{h:a,s:n,v:o}}(h.value,g.value,v.value);u.value=t,d.value=l,c.value=n,o.value=`top: ${100-100*n}%;left: ${100*l}%;`,r.value=`left: ${u.value/360*100}%;`})),$(p,(()=>{console.log(m),console.log(m.hex8),a.emit("update:color",m.value.hex8),s.value=`left: ${p.value>=1?"calc(100% - 6px)":100*p.value+"%"};`}));let m=A((()=>{let e=h.value,t=g.value,l=v.value,a=p.value,n=u.value,o=d.value,r=c.value;return{rgb:`rgba(${e},${t},${l})`,rgba:`rgba(${e},${t},${l},${a})`,hex6:F(e,t,l),hex8:F(e,t,l,a),hsv:`hsv(${n},${o},${r})`,hsl:""}}));function f(e){let t=n.saturation_value.value.clientWidth,l=n.saturation_value.value.clientHeight,a=e.pageX-n.saturation_value.value.getBoundingClientRect().left,r=e.pageY-n.saturation_value.value.getBoundingClientRect().top;a=a<t&&a>0?a:a>t?t:0,r=r<l&&r>0?r:r>l?l:0,d.value=Math.floor(a/t*100+.5)/100,c.value=Math.floor(100*(1-r/l)+.5)/100;let{r:i,g:s,b:p}=x(u.value,d.value,c.value);h.value=i,g.value=s,v.value=p,o.value=`top: ${r}px;left: ${a}px;`}function b(e){window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",b)}function y(e){let t=n.hue_slider.value.clientWidth,l=e.pageX-n.saturation_value.value.getBoundingClientRect().left;l=l<t&&l>0?l:l>t?t:0,u.value=Math.floor(l/t*360+.5);let{r:a,g:o,b:i}=x(u.value,d.value,c.value);h.value=a,g.value=o,v.value=i,r.value=`left: ${l>=t-6?t-6:l}px;`}function w(e){window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",w)}function C(e){let t=n.alpha_slider.value.clientWidth,l=e.pageX-n.saturation_value.value.getBoundingClientRect().left;l=l<t&&l>0?l:l>t?t:0,p.value=Math.floor(l/t*100+.5)/100,s.value=`left: ${l>=t-6?t-6:l}px;`}function k(e){window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",k)}function x(e,t,l){360===e&&(e=0);let a,n,o,r=Math.floor(e/60)%6,i=e/60-r,s=l*(1-t),u=l*(1-t*i),d=l*(1-t*(1-i));return 0===r?(a=l,n=d,o=s):1===r?(a=u,n=l,o=s):2===r?(a=s,n=l,o=d):3===r?(a=s,n=u,o=l):4===r?(a=d,n=s,o=l):5===r&&(a=l,n=s,o=u),a=Math.floor(255*a+.5),n=Math.floor(255*n+.5),o=Math.floor(255*o+.5),{r:a,g:n,b:o}}function F(e,t,l,a=1){let n=2!==(e=parseInt(e)).toString(16).length?"0"+e.toString(16):e.toString(16),o=2!==(t=parseInt(t)).toString(16).length?"0"+t.toString(16):t.toString(16),r=2!==(l=parseInt(l)).toString(16).length?"0"+l.toString(16):l.toString(16),i="";if(1!==(a=parseFloat(a))){let e=Math.floor(256*a);i=2!==e.toString(16).length?"0"+e.toString(16):e.toString(16)}return`#${n}${o}${r}${i}`.toUpperCase()}function I(e){if(/^#?[0-9a-fA-F]{3}$/.test(e)){let t=e.substring(e.length-1,e.length),l=e.substring(e.length-2,e.length-1),a=e.substring(e.length-3,e.length-2);return I(`${a+a}${l+l}${t+t}`)}if(/^#?[0-9a-fA-F]{4}$/.test(e)){let t=e.substring(e.length-1,e.length),l=e.substring(e.length-2,e.length-1),a=e.substring(e.length-3,e.length-2),n=e.substring(e.length-4,e.length-3);return I(`${n+n}${a+a}${l+l}${t+t}`)}if(/^#?[0-9a-fA-F]{6}$/.test(e)){let t=parseInt("0x"+e.substring(e.length-2,e.length)),l=parseInt("0x"+e.substring(e.length-4,e.length-2));return{r:parseInt("0x"+e.substring(e.length-6,e.length-4)),g:l,b:t,a:1}}if(/^#?[0-9a-fA-F]{8}$/.test(e)){let t=parseInt("0x"+e.substring(e.length-2,e.length));t/=255;let l=parseInt("0x"+e.substring(e.length-4,e.length-2)),a=parseInt("0x"+e.substring(e.length-6,e.length-4));return{r:parseInt("0x"+e.substring(e.length-8,e.length-6)),g:a,b:l,a:t}}}return S=i({},n),t(S,l({pointStyle:o,hueSliderStyle:r,alphaSliderStyle:s,hue:u,saturation:d,value:c,red:h,green:g,blue:v,alpha:p,colorObj:m,hexChange:function(e){let t=e.target.value;if(/^#?([0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)){let{r:e,g:l,b:a,a:n}=I(t);h.value=e,g.value=l,v.value=a,p.value=n}},redChange:function(e){let t=e.target.value;""!==t&&(t>255&&(h.value=255),t<0&&(h.value=0),t>=0&&t<=255&&(h.value=parseInt(t)))},greenChange:function(e){let t=e.target.value;""!==t&&(t>255&&(g.value=255),t<0&&(g.value=0),t>=0&&t<=255&&(g.value=parseInt(t)))},blueChange:function(e){let t=e.target.value;""!==t&&(t>255&&(v.value=255),t<0&&(v.value=0),t>=0&&t<=255&&(v.value=parseInt(t)))},alphaChange:function(e){let t=e.target.value;""!==t&&(t=parseFloat(t),p.value=t,t>1&&(p.value=1),t<0&&(p.value=0),t>=0&&t<=1&&(p.value=t))},presetChange:function(e){if(/^#?([0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(e)){let{r:t,g:l,b:a,a:n}=I(e);h.value=t,g.value=l,v.value=a,p.value=n}},mousedownSV:function(e){f(e),window.addEventListener("mousemove",f),window.addEventListener("mouseup",b)},mousedownHue:function(e){y(e),window.addEventListener("mousemove",y),window.addEventListener("mouseup",w)},mousedownAlpha:function(e){C(e),window.addEventListener("mousemove",C),window.addEventListener("mouseup",k)}}));var S}},Q=U();D("data-v-1062700d");const Z={class:"color-select"},ee=j("div",{class:"saturation-value-2"},null,-1),te=j("div",{class:"saturation-value-3"},null,-1),le={class:"color-select-middle"},ae={style:{flex:"auto"}},ne={class:"color-diamond"},oe={class:"color-value"},re={class:"hex"},ie=j("p",null,"Hex",-1),se={class:"rgba-r"},ue=j("p",null,"R",-1),de={class:"rgba-g"},ce=j("p",null,"G",-1),he={class:"rgba-b"},ge=j("p",null,"B",-1),ve={class:"rgba-a"},pe=j("p",null,"A",-1),me={class:"preset"};E();const fe=Q(((e,t,l,a,n,o)=>(O(),B("div",Z,[j("div",{class:"saturation-value",ref:"saturation_value",onMousedown:t[1]||(t[1]=(...e)=>a.mousedownSV&&a.mousedownSV(...e))},[j("div",{style:`background-color: hsl(${a.hue}, 100%, 50%);`},[j("div",{class:"point",style:a.pointStyle},null,4)],4),ee,te],544),j("div",le,[j("div",ae,[j("div",{class:"hue-slider",ref:"hue_slider",onMousedown:t[2]||(t[2]=(...e)=>a.mousedownHue&&a.mousedownHue(...e))},[j("div",{class:"slider",style:a.hueSliderStyle},null,4)],544),j("div",{class:"alpha-slider",ref:"alpha_slider",onMousedown:t[3]||(t[3]=(...e)=>a.mousedownAlpha&&a.mousedownAlpha(...e))},[j("div",{class:"slider",style:a.alphaSliderStyle},null,4),j("div",{style:`background: linear-gradient(to right, rgba(0,0,0,0), ${a.colorObj.rgb});width: 100%;height: 100%`},null,4)],544)]),j("div",ne,[j("div",{style:`background-color: ${a.colorObj.rgba};width: 100%;height: 100%;box-shadow: inset 0 0 0 1px rgba(0, 0, 0, .15), inset 0 0 4px rgba(0, 0, 0, .25);`},null,4)])]),j("div",oe,[j("div",re,[j("label",null,[j("input",{value:a.colorObj.hex8,onInput:t[4]||(t[4]=(...e)=>a.hexChange&&a.hexChange(...e)),spellcheck:"false"},null,40,["value"])]),ie]),j("div",se,[j("label",null,[j("input",{value:a.red,onInput:t[5]||(t[5]=(...e)=>a.redChange&&a.redChange(...e))},null,40,["value"])]),ue]),j("div",de,[j("label",null,[j("input",{value:a.green,onInput:t[6]||(t[6]=(...e)=>a.greenChange&&a.greenChange(...e))},null,40,["value"])]),ce]),j("div",he,[j("label",null,[j("input",{value:a.blue,onInput:t[7]||(t[7]=(...e)=>a.blueChange&&a.blueChange(...e))},null,40,["value"])]),ge]),j("div",ve,[j("label",null,[j("input",{value:a.alpha,onInput:t[8]||(t[8]=(...e)=>a.alphaChange&&a.alphaChange(...e))},null,40,["value"])]),pe])]),j("ul",me,[(O(!0),B(V,null,M(l.preset,(e=>(O(),B("li",{key:e,style:`background-color: ${e}`,onClick:t=>a.presetChange(e)},null,12,["onClick"])))),128))])]))));q.render=fe,q.__scopeId="data-v-1062700d";var be={components:{Picker:q},props:{label:String,color:String},emits:{change:null,"update:color":null},setup(e,t){let l=_(!1),a=_(e.color);$(a,(e=>{console.log(e),t.emit("update:color",e),t.emit("change")})),$((()=>e.color),(e=>{a.value=e}));return{color2:a,visible:l,show:()=>{l.value=!0},close:()=>{l.value=!1}}}};const ye=U(),we=ye(((e,t,l,a,n,o)=>{const r=P("a-col"),i=P("a-row"),s=P("picker");return O(),B(V,null,[j(i,null,{default:ye((()=>[j(r,{span:8},{default:ye((()=>[j("div",null,L(l.label)+":",1)])),_:1}),j(r,{span:16},{default:ye((()=>[j("div",{style:`background-color: ${a.color2};`,class:"color",onClick:t[1]||(t[1]=(...e)=>a.show&&a.show(...e))},null,4)])),_:1})])),_:1}),a.visible?(O(),B(s,{key:0,onMouseleave:a.close,color:a.color2,"onUpdate:color":t[2]||(t[2]=e=>a.color2=e)},null,8,["onMouseleave","color"])):z("",!0)],64)}));be.render=we,be.__scopeId="data-v-79d43f5f";var Ce={components:{PickerItem:be},props:{modelValue:String,algorithmForm:Array},emits:{"update:modelValue":null,change:null},setup(e,t){const l=_(e.modelValue),a=_(!1),n=()=>{var t,l;const a=new Object;let n=!1;if(e.modelValue){let l=e.modelValue.split(",");l.length===e.algorithmForm.length&&(console.log("0000"),null==(t=e.algorithmForm)||t.map(((e,t)=>{let n=l[t];"number-slider"==e.type?a[e.name]=parseInt(n):a[e.name]=n})),n=!0)}return n||null==(l=e.algorithmForm)||l.map(((e,t)=>{a[e.name]=e.defult})),a},o=H(n()),r=H({}),{resetFields:i,validate:s,validateInfos:u}=S(o,r);return{active:l,visible:a,show:()=>{i(n()),a.value=!0},change:()=>{let a="";e.algorithmForm.map(((t,l)=>{a+=o[t.name],l!==e.algorithmForm.length-1&&(a+=",")})),l.value=a,console.log(232),t.emit("update:modelValue",l.value),t.emit("change")},onClose:()=>{a.value=!1},form:o,resetFields:i,validate:s,validateInfos:u}}};const ke=G("编辑算法");Ce.render=function(e,t,l,a,n,o){const r=P("a-button"),i=P("a-input"),s=P("a-form-item"),u=P("a-slider"),d=P("algorithm",!0),c=P("picker-item"),h=P("a-form"),g=P("a-drawer");return O(),B(V,null,[j(r,{onClick:a.show},{default:W((()=>[ke])),_:1},8,["onClick"]),j(g,{closable:!1,visible:a.visible,onClose:a.onClose,title:"节点属性",placement:"right"},{default:W((()=>[j(h,{"label-col":{span:8},"wrapper-col":{span:16}},{default:W((()=>[(O(!0),B(V,null,M(l.algorithmForm,((e,t)=>(O(),B("div",{key:t},["text"===e.type||"symbol"===e.type?(O(),B(s,T({key:0},a.validateInfos[e.name],{label:e.label}),{default:W((()=>[j(i,{onChange:e=>a.change(t),value:a.form[e.name],"onUpdate:value":t=>a.form[e.name]=t},null,8,["onChange","value","onUpdate:value"])])),_:2},1040,["label"])):z("",!0),"number"===e.type?(O(),B(s,T({key:1},a.validateInfos[e.name],{label:e.label}),{default:W((()=>[j(i,{onChange:e=>a.change(t),value:a.form[e.name],"onUpdate:value":t=>a.form[e.name]=t},null,8,["onChange","value","onUpdate:value"])])),_:2},1040,["label"])):z("",!0),"number-slider"===e.type?(O(),B(s,T({key:2},a.validateInfos[e.name],{label:e.label}),{default:W((()=>[j(u,{onChange:e=>a.change(t),value:a.form[e.name],"onUpdate:value":t=>a.form[e.name]=t,marks:e.marks},null,8,["onChange","value","onUpdate:value","marks"])])),_:2},1040,["label"])):z("",!0),"algorithm"===e.type?(O(),B(s,T({key:3},a.validateInfos[e.name],{label:e.label}),{default:W((()=>[j(d,{onChange:e=>a.change(t),modelValue:a.form[e.name],"onUpdate:modelValue":t=>a.form[e.name]=t},null,8,["onChange","modelValue","onUpdate:modelValue"])])),_:2},1040,["label"])):z("",!0),"color"===e.type?(O(),B(s,T({key:4,"label-col":{span:0},"wrapper-col":{span:24}},a.validateInfos[e.name]),{default:W((()=>["color"===e.type?(O(),B(c,{key:0,onChange:e=>a.change(t),color:a.form[e.name],"onUpdate:color":t=>a.form[e.name]=t,label:e.label},null,8,["onChange","color","onUpdate:color","label"])):z("",!0)])),_:2},1040)):z("",!0)])))),128))])),_:1})])),_:1},8,["visible","onClose"])],64)};var xe={components:{Algorithm:Ce,Picker:q,PickerItem:be},props:{visible:Boolean,nodeForm:Array,graph:y,currentNode:w,type:String,nodeData:Object},emits:{"update:visible":null,"update:nodeData":null,delete:null},setup(e,t){let l=e.nodeData;l||(l={});const a=()=>{const t=new Object,l=e.nodeForm,a=e.currentNode,n=e.nodeData;return null==l||l.map(((l,o)=>{let r="";if(l.func)r=l.func(a);else if(l.dom){const t=e.graph.findView(e.currentNode).findOne("foreignObject > body > div>div");r=l.dom(t)}else l.attr?(r=a.getAttrByPath(l.attr),"color"===l.type&&(r?"none"===r&&(r="#23232300"):r="#232323")):l.save?(r=n[l.save],r||(r="")):l.defult&&(r||(r=l.defult));"number"!==l.type&&"number-slider"!==l.type||r&&""!=r||(r=0),t[l.name]=r})),t},n=H(a());$((()=>e.currentNode),(t=>{if(e.visible){l=e.nodeData;const t=a();r(t)}}));const o=H({}),{resetFields:r,validate:i,validateInfos:s}=S(n,o);return{form:n,nodeDataSave:l,validateInfos:s,resetFields:r,change:t=>{var a;const o=e.nodeForm[t];if(console.log(o),o.save&&(l[o.save]=n[o.name]),o.func)o.func(e.currentNode,n[o.name]);else if(o.attr)null==(a=e.currentNode)||a.setAttrByPath(o.attr,n[o.name]);else if(o.dom){const t=e.graph.findView(e.currentNode).findOne("foreignObject > body > div>div");o.dom(t,n[o.name])}},afterVisibleChange:e=>{},onClose:()=>{t.emit("update:visible",!1),t.emit("update:nodeData",l)},deleteNode:()=>{t.emit("delete")}}}};const Fe=U();D("data-v-1b91c830");const Ie=G("删除");E();const Se=Fe(((e,t,l,a,n,o)=>{const r=P("a-input"),i=P("a-form-item"),s=P("a-slider"),u=P("algorithm"),d=P("picker-item"),c=P("a-button"),h=P("a-form"),g=P("a-drawer");return O(),B("div",null,[j(g,{closable:!1,visible:l.visible,"after-visible-change":a.afterVisibleChange,onClose:a.onClose,title:"节点属性",placement:"right"},{default:Fe((()=>[j(h,{"label-col":{span:8},"wrapper-col":{span:16}},{default:Fe((()=>[(O(!0),B(V,null,M(l.nodeForm,((e,t)=>(O(),B("div",{key:t},["text"===e.type?(O(),B(i,T({key:0},a.validateInfos[e.name],{label:e.label}),{default:Fe((()=>[j(r,{onChange:e=>a.change(t),value:a.form[e.name],"onUpdate:value":t=>a.form[e.name]=t},null,8,["onChange","value","onUpdate:value"])])),_:2},1040,["label"])):z("",!0),"number"===e.type?(O(),B(i,T({key:1},a.validateInfos[e.name],{label:e.label}),{default:Fe((()=>[j(r,{onChange:e=>a.change(t),value:a.form[e.name],"onUpdate:value":t=>a.form[e.name]=t},null,8,["onChange","value","onUpdate:value"])])),_:2},1040,["label"])):z("",!0),"number-slider"===e.type?(O(),B(i,T({key:2},a.validateInfos[e.name],{label:e.label}),{default:Fe((()=>[j(s,{onChange:e=>a.change(t),value:a.form[e.name],"onUpdate:value":t=>a.form[e.name]=t,marks:e.marks},null,8,["onChange","value","onUpdate:value","marks"])])),_:2},1040,["label"])):z("",!0),"algorithm"===e.type?(O(),B(i,T({key:3},a.validateInfos[e.name],{label:e.label}),{default:Fe((()=>[j(u,{onChange:e=>a.change(t),modelValue:a.form[e.name],"onUpdate:modelValue":t=>a.form[e.name]=t,algorithmForm:e.algorithm.form},null,8,["onChange","modelValue","onUpdate:modelValue","algorithmForm"])])),_:2},1040,["label"])):z("",!0),"color"===e.type?(O(),B(i,T({key:4,"label-col":{span:0},"wrapper-col":{span:24}},a.validateInfos[e.name]),{default:Fe((()=>["color"===e.type?(O(),B(d,{key:0,onChange:e=>a.change(t),color:a.form[e.name],"onUpdate:color":t=>a.form[e.name]=t,label:e.label},null,8,["onChange","color","onUpdate:color","label"])):z("",!0)])),_:2},1040)):z("",!0)])))),128)),j(i,{label:"操作"},{default:Fe((()=>[j(c,{onClick:a.deleteNode},{default:Fe((()=>[Ie])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["visible","after-visible-change","onClose"])])}));xe.render=Se,xe.__scopeId="data-v-1b91c830";var _e={components:{NodeFormDefult:xe},props:{graph:y,graphDesc:Object,init:Boolean},setup(e,t){const l=H([]),a=_(!1),n=H({node:{}}),o=_(-1),r=_(!1),i=A((()=>{let e=n.node;return e.getData?C[null==e?void 0:e.getData().type]:[]})),{proxy:s}=J(),u=s.$api;u.graph.node.lists(e.graphDesc).then((e=>{console.log(e),e.map((e=>{l.push(e)}))}));const d=e=>l.findIndex((t=>t.nodeId===e)),c=(t,l,a)=>{var o,r;return{nodeId:null==(o=n.node)?void 0:o.id,dataurl:t,graphId:null==(r=e.graphDesc)?void 0:r.graphId,active:l,title:a}};return N((()=>{var t;null==(t=e.graph)||t.on("node:click",(({node:e})=>{n.node=e;let t=d(e.id);t>-1?o.value=t:(o.value=l.length,l.push(c("","",""))),a.value=!0,r.value||(r.value=!0)}))})),{nodes:l,visibleDrawer:a,currentNode:n,currentIndex:o,nodeForm:i,initFinsh:r,save:()=>{u.graph.graph.saveJson({json:JSON.stringify(e.graph.toJSON()),id:e.graphDesc.graphId}).then((e=>{console.log(e)})),u.graph.node.saveOrUpdateBatch(l).then((e=>{console.log(e)}))},deleteNode:()=>{e.graph.removeNode(n.node.id);let t=d(n.node.id);t>-1&&l.splice(t,1)},create:()=>{u.graph.graph.readJson({id:"json"}).then((t=>{t.map((t=>{if(l.findIndex((e=>e.num==t.num&&e.type==t.type))>-1);else{e.graph.getSelectedCells;const a=e.graph.createNode({shape:"html",width:60,height:60,label:t.num,html:()=>{const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e},data:{type:"html",message:t.type}});n.node=a,l.push(c(t.url,"",t.num));const o=e.graph.createNode({shape:"html",width:60,height:60,label:t.num,html:()=>{const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e},data:{type:"html",message:"警告"}});e.graph.addNode(a),e.graph.addNode(o),n.node=o,l.push(c(t.url2,"",t.num))}}))}))},updateByFile:()=>{u.graph.graph.readJson({id:"json"}).then((e=>{console.log(e),e.map((e=>{console.log(e);const t=l.findIndex((t=>t.num==e.num&&t.type==e.type));t>-1&&(l[t].title=e.title,l[t].dataurl=e.url,l[t].active=e.active,l[t].pre=e.pre,"模拟量"==e.type&&(l[t].after=e.after));const a=l.findIndex((t=>t.num==e.num&&"警告"==t.type));a>-1&&(l[a].active=e.active2,l[a].title=e.title,l[a].dataurl=e.url2)}))}))}}}};const Ne=G("根据文件创建"),$e=G("根据文件更新"),Ae=G("保存");_e.render=function(e,t,l,a,n,o){const r=P("a-button"),i=P("node-form-defult");return O(),B("div",null,[j(r,{onClick:a.create},{default:W((()=>[Ne])),_:1},8,["onClick"]),j(r,{onClick:a.updateByFile},{default:W((()=>[$e])),_:1},8,["onClick"]),j(r,{onClick:a.save},{default:W((()=>[Ae])),_:1},8,["onClick"]),a.initFinsh?(O(),B(i,{key:0,currentNode:a.currentNode.node,nodeForm:a.nodeForm,graph:l.graph,visible:a.visibleDrawer,"onUpdate:visible":t[1]||(t[1]=e=>a.visibleDrawer=e),nodeData:a.nodes[a.currentIndex],"onUpdate:nodeData":t[2]||(t[2]=e=>a.nodes[a.currentIndex]=e),onDelete:a.deleteNode},null,8,["currentNode","nodeForm","graph","visible","nodeData","onDelete"])):z("",!0)])};const{Stencil:De}=Y;var Ee={props:{visibleDrawer:Boolean,graph:y},data:()=>({visible:!1,initFinsh:!1}),methods:{afterVisibleChange(e){console.log("visible",e),e&&(this.initFinsh||(this.init(),this.initFinsh=!0))},showDrawer(){this.visible=!0},onClose(){this.visible=!1},init(){const e=this.graph,t=e.createNode({label:"opc数值组件",width:120,height:60,attrs:{body:{fill:"none",stroke:"none"}},data:{type:"text"}}),l=e.createNode({shape:"circle",width:60,height:60,label:"circle",attrs:{body:{fill:"#efdbff",stroke:"none"}},data:{type:"circle"}}),a=e.createNode({shape:"html",width:60,height:60,html:()=>{const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.innerText="模拟量",e},data:{type:"html",message:"模拟量"}}),n=e.createNode({shape:"html",width:60,height:60,html:()=>{const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.innerText="开关量",e},data:{type:"html",message:"开关量"}}),o=e.createNode({shape:"html",width:60,height:60,html:()=>{const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.innerText="警告",e},data:{type:"html",message:"警告"}}),r=new De({title:"Components",target:e,search:(e,t)=>-1!==e.shape.indexOf(t),validateNode:(e,t)=>"html"!==e.shape||new Promise((e=>{const{draggingNode:l,draggingGraph:a}=t,n=a.findView(l).findOne("foreignObject > body > div>div");k(n,"validating "),setTimeout((()=>{x(n,"validating"),e(!0)}),3e3)})),placeholder:"搜索组件",notFoundText:"Not Found",collapsable:!0,stencilGraphWidth:200,stencilGraphHeight:180,groups:[{name:"group1",title:"组态标准件"},{name:"group2",title:"组态线"}]});this.$refs.refStencil.appendChild(r.container),r.load([a,n,o],"group1"),r.load([t,l],"group2")}},mounted(){this.visible=this.$props.visibleDrawer}};const Oe=U();D("data-v-4a4c04df");const Be=G(" Open "),je={className:"app-stencil",id:"stencil",ref:"refStencil"};E();const Ve=Oe(((e,t,l,a,n,o)=>{const r=P("a-button"),i=P("a-drawer");return O(),B("div",null,[j(r,{type:"primary",onClick:o.showDrawer},{default:Oe((()=>[Be])),_:1},8,["onClick"]),j(i,{closable:!1,visible:n.visible,"after-visible-change":o.afterVisibleChange,onClose:o.onClose,title:"节点属性",placement:"right"},{default:Oe((()=>[j("div",je,null,512)])),_:1},8,["visible","after-visible-change","onClose"])])}));Ee.render=Ve,Ee.__scopeId="data-v-4a4c04df";var Me={components:{AntNode:_e,AntStencil:Ee},setup(e,t){const l=R(K),a=H({ant:null,data:l.getters.graph}),n=_(!1),o=_(!1);let r=null;const s=_(!1),u=_(null),d=_(null),c=_(!1),{proxy:h}=J(),g=h.$api,v=_(0),p=_(0),m=_(0),f=_(0),b=_(0),w=_(0),k=_(0),x=_(0),S=_(0),$=_(0);const A=()=>{clearInterval(r)},D=()=>{g.graph.graph.readJson({id:a.data.graphId}).then((e=>{console.log(e),a.ant.fromJSON(e),a.ant.getNodes().map((e=>{if("html"===e.shape){const t=a.ant.findView(e).findOne("foreignObject > body > div");0===t.childElementCount&&t.append(E("")),e.setAttrByPath(I.fontSize,"5")}}))}))},E=e=>{const t=document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.borderRadius="100%",t.innerText=e,t};X((()=>{A()})),N((()=>{(()=>{if(s.value)return;console.log("执行了"),a.ant=new y({container:u.value,width:parseInt(a.data.width),height:parseInt(a.data.height),grid:{visible:!1,size:2},resizing:{enabled:()=>o.value},snapline:{enabled:!0,sharp:!0,tolerance:2},interacting:{nodeMovable:()=>o.value},selecting:{enabled:()=>o.value,rubberband:!0,showNodeSelectionBox:!0},connecting:{router:"manhattan",createEdge:()=>new F({shape:"custom-edge"})}}),y.unregisterEdge("custom-edge"),y.registerEdge("custom-edge",{inherit:"edge",attrs:{line:{stroke:"#5755a1"}},defaultLabel:{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{label:{fill:"black",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},body:{ref:"label",fill:"white",stroke:"#5755a1",strokeWidth:2,rx:4,ry:4,refWidth:"140%",refHeight:"140%",refX:"-20%",refY:"-20%"}},position:{distance:100,options:{absoluteDistance:!0,reverseDistance:!0}}}},!0),y.registerNode("custom-image",{inherit:"rect",width:52,height:52,zIndex:100,markup:[{tagName:"image"}],attrs:{image:{width:52,height:52}},ports:i({},{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]})},!0),y.registerNode("custom-text",{inherit:"rect",width:26,height:26,zIndex:100,markup:[{tagName:"text",selector:"label"}],attrs:{label:{textAnchor:"left",textVerticalAnchor:"top",fontSize:18,fill:"yellow"}}},!0),a.ant.drawBackground({image:"/background.jpg",position:"center",size:"100% auto"}),s.value=!0,console.log(a.ant)})(),D()}));const O=_(1);return{graph:a,initFinsh:s,stencil:c,showDrawer:function(){c.value=!0},refContainer:u,refScreen:d,fullScreen:()=>{let e=document.getElementById("refScreen"),t=document.getElementById("myGraph");console.log(e),console.log(t),e.requestFullscreen().then((l=>{S.value=Number.parseInt(a.data.width),$.value=Number.parseInt(a.data.height),k.value=e.clientWidth,x.value=e.clientHeight,console.log(k.value),console.log(x.value),m.value=k.value/S.value,f.value=x.value/$.value,b.value=(k.value-S.value)/2,w.value=(x.value-$.value)/2,t.style.width=S+"px",t.style.height=$+"px",e.style.width=k.value+"px",e.style.height=x.value+"px",t.style.transform="translate("+b.value+"px,"+w.value+"px)  scale("+m.value+","+f.value+") ",console.log("正常打开全屏")}),(e=>{console.log("不正常打开全屏")}))},run:()=>{(()=>{o.value=!1;let e=a.ant;e.disablePanning(),e.disableSelection()})(),n.value||(r=setInterval((()=>{g.graph.node.lists(a.data).then((e=>{e.map((e=>{let t=a.ant.getCellById(e.nodeId);if(t.setAttrByPath(I.lable,""),t&&("模拟量"===t.data.message?(t.setAttrByPath(I.lable,e.pre+":"+e.data+e.after),t.setAttrByPath(I.fontSize,"5")):"开关量"===t.data.message&&(t.setAttrByPath(I.lable,e.pre),t.setAttrByPath(I.color,"#000000")),e.active)){let l=t.data.type;if(l){let n=C[l];if(n){n.filter((e=>"algorithm"===e.type)).map((l=>{l.algorithm.run(t,a.ant,e.active,e.data)}))}}}}))}))}),3e3))},isDev:o,dev:()=>{o.value=!0,a.ant.enableSelection(),A(),D()},index:O,toCenter:e=>{let t=document.getElementById("myGraph");if(document.getElementById("refScreen"),console.log(e),0===v.value&&0===p.value){const l=2;v.value=e.x,p.value=e.y,t.style.transform="translate("+(b.value+(k.value/2-v.value)*(l-1))+"px,"+(w.value+(x.value/2-p.value)*(l-1))+"px)  scale("+m.value*l+","+f.value*l+") "}else v.value=0,p.value=0,t.style.transform="translate("+b.value+"px,"+w.value+"px)  scale("+m.value+","+f.value+") "}}}};const Ue=G("全屏"),Pe=G("运行"),Le=G("开发模式"),ze={id:"refScreen"};Me.render=function(e,t,l,a,n,o){const r=P("a-button"),i=P("ant-stencil"),s=P("ant-node");return O(),B("div",null,[j(r,{onClick:a.fullScreen},{default:W((()=>[Ue])),_:1},8,["onClick"]),j(r,{onClick:a.run},{default:W((()=>[Pe])),_:1},8,["onClick"]),j(r,{onClick:a.dev},{default:W((()=>[Le])),_:1},8,["onClick"]),j("input",{"v-model":a.index},null,8,["v-model"]),a.initFinsh&&a.isDev?(O(),B(i,{key:0,graph:a.graph.ant,visibleDrawer:a.stencil},null,8,["graph","visibleDrawer"])):z("",!0),a.initFinsh&&a.isDev?(O(),B(s,{key:1,graph:a.graph.ant,init:a.initFinsh,graphDesc:a.graph.data},null,8,["graph","init","graphDesc"])):z("",!0),j("div",ze,[j("div",{className:"graph",id:"myGraph",ref:"refContainer",onDblclickwo:t[1]||(t[1]=(...e)=>a.toCenter&&a.toCenter(...e))},null,544)])])};export default Me;
